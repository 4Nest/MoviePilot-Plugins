# 重复文件检测与清理 (DuplicateDetector)

一个为 MoviePilot 设计的插件，用于自动扫描媒体库中的重复文件，并支持网盘源文件的同步删除。

## ✨ 主要功能

- **智能扫描**: 自动扫描指定目录下的重复视频文件（基于文件名和TMDB ID）。
- **精准识别**:
  - 🎬 **电影**: 基于 TMDB ID 识别重复。
  - 📺 **剧集**: 解析季号(Season)和集号(Episode)，按集识别重复。
- **直观展示**:
  - 剧集按季合并显示（如 `S01 (E01,E02...)`）。
  - 清晰展示重复文件路径、大小和修改时间。
- **一键清理**: 支持在插件页面直接删除多余文件。
- **网盘同步删除** ☁️:
  - 删除本地 `.strm` 文件时，自动同步删除网盘中的源文件。
  - 支持配置路径映射（将本地挂载路径映射回网盘路径）。
  - 集成 `StorageChain`，支持 **115网盘**、**123云盘** 等多种存储后端。
  - 自动清理空文件夹。

## ⚙️ 配置说明

在使用插件前，请在配置页面进行如下设置：

| 配置项 | 说明 | 示例 |
| :--- | :--- | :--- |
| **扫描路径** | 需要扫描重复文件的本地目录，支持换行输入多个路径。 | `/media/strm/movie`<br>`/media/strm/tv` |
| **文件后缀** | 需要扫描的媒体文件后缀，用逗号分隔。 | `strm,mkv,mp4` |
| **扫描类型** | 选择扫描电影、剧集或自动识别。 | `自动` |
| **最小重复数** | 当同一媒体的文件数量达到该值时会被列出。 | `2` |
| **STRM库路径** | 本地 strm 文件的根目录（用于路径映射）。 | `/media/strm` |
| **网盘映射路径** | 对应的网盘挂载根目录（用于路径映射）。 | `/media` |
| **存储类型** | 网盘的存储后端类型，需与 MoviePilot 存储配置一致。 | - `local`: 本地/Rclone挂载<br>- `u115`: 115网盘<br>- `123云盘`: 123云盘 |

### 🛠️ 路径映射示例

假设您的系统中有以下路径结构：
- 本地 strm: `/media/strm/Anime/Show/S01E01.strm`
- 网盘源文件: `/media/Anime/Show/S01E01.mkv`

配置如下：
- **STRM库路径**: `/media/strm`
- **网盘映射路径**: `/media`
- **存储类型**: `local` (如果是本地挂载) 或 `u115` (如果是API驱动)

## 🚀 使用方法

1. **安装插件**: 将插件文件夹放入 MoviePilot 的 `plugins` 目录。
2. **启用插件**: 在插件配置页启用，并填写配置项。
3. **运行扫描**: 插件会自动运行（或设置只运行一次）。
4. **查看结果**: 点击插件图标进入详情页，查看扫描到的重复文件列表。
5. **删除文件**: 点击垃圾桶图标 🗑️ 删除指定文件。
   - 删除时会自动尝试删除对应的网盘源文件。
   - 系统会自动清理残留的空文件夹。

## ⚠️ 注意事项

- **数据安全**: 删除操作不可恢复，请谨慎操作！
- **文件名匹配**: 插件通过文件名（不含后缀）匹配网盘文件。请确保 strm 文件名与源文件名一致（后缀除外）。
- **权限**: 确保 MoviePilot 对扫描目录和网盘挂载路径有读写权限。

## 👨‍💻 作者

**NEST**

---
Powered by MoviePilot Plugins Framework
